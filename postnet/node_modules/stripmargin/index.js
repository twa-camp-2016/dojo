var assert = require('assert');

function stripMargin(text) {
	assert(typeof text === 'string');
	var SEP = text.indexOf('\r\n') !== -1 ? '\r\n' : '\n';
	var arr = text.split(SEP);
	for (var i = 0, l = arr.length; i < l; i++) {
		arr[i] = arr[i].trimLeft();
		if (arr[i].indexOf('|') == 0) {
			arr[i] = arr[i].substr(1);
		}
	}
	return arr.reduce(function (a, b) {
		if (b === '') {
			return a;
		} else {
			return a + SEP + b;
		}
	});
}

function inject() {
	if (String.prototype.stripMargin) {
		delete String.prototype.stripMargin;
	} else {
		String.prototype.stripMargin = function () {
			return stripMargin(this.valueOf());
		}
	}
}

module.exports = exports = { stripMargin: stripMargin, inject: inject };